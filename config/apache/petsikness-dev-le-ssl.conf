<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName petsiknessdev.sikwow.com
    ServerAdmin admin@sikwow.com

    # Logs
    ErrorLog /opt/petsikness/logs/apache-dev-error.log
    CustomLog /opt/petsikness/logs/apache-dev-access.log combined

    # Proxy a Next.js desarrollo (puerto 3002)
    ProxyPreserveHost On
    
    # Headers críticos para OAuth dinámico (unset primero para evitar duplicados)
    RequestHeader unset X-Forwarded-Proto
    RequestHeader unset X-Forwarded-SSL
    RequestHeader unset X-Forwarded-Host
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-SSL "on"
    RequestHeader set X-Forwarded-Host "petsiknessdev.sikwow.com"
    
    ProxyPass / http://localhost:3002/
    ProxyPassReverse / http://localhost:3002/

    # WebSocket support (crítico para next dev hot reload)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:3002/$1" [P,L]

    # Headers menos restrictivos en dev
    Header always set X-Frame-Options "SAMEORIGIN"

    # Certificados SSL (se generarán con certbot)
    SSLCertificateFile /etc/letsencrypt/live/petsiknessdev.sikwow.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/petsiknessdev.sikwow.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
