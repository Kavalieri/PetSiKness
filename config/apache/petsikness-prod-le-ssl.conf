<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName petsikness.sikwow.com
    ServerAdmin admin@sikwow.com

    # Logs
    ErrorLog /opt/petsikness/logs/apache-prod-error.log
    CustomLog /opt/petsikness/logs/apache-prod-access.log combined

    # Proxy a Next.js producción (puerto 3003)
    ProxyPreserveHost On
    
    # CRÍTICO: Pasar el protocolo HTTPS correcto (para OAuth)
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-SSL "on"
    RequestHeader set X-Forwarded-Host "petsikness.sikwow.com"
    
    ProxyPass / http://localhost:3003/
    ProxyPassReverse / http://localhost:3003/

    # Headers seguros
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

    # Certificados SSL (se generarán con certbot)
    SSLCertificateFile /etc/letsencrypt/live/petsikness.sikwow.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/petsikness.sikwow.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
